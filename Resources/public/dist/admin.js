var config={title:"Интернет магазин",menu:{items:[{title:"Магазины",url:"extension.shop.list",items:[{title:"Список",url:"extension.shop.list"},{title:"Добавить",url:"extension.shop.create"}]},{title:"Категории",url:"extension.shop.category.list",items:[{title:"Список",url:"extension.shop.category.list"},{title:"Добавить",url:"extension.shop.category.create"}]},{title:"Доставка",url:"extension.shop.delivery.list",items:[{title:"Список",url:"extension.shop.delivery.list"},{title:"Добавить",url:"extension.shop.delivery.create"}]},{title:"Производители",url:"extension.shop.manufacturer.list",items:[{title:"Список",url:"extension.shop.manufacturer.list"},{title:"Добавить",url:"extension.shop.manufacturer.create"}]},{title:"Заказы",url:"extension.shop.order.list",items:[{title:"Список",url:"extension.shop.order.list"},{title:"Добавить",url:"extension.shop.order.create"}]},{title:"Статусы заказа",url:"extension.shop.order.status.list",items:[{title:"Список",url:"extension.shop.order.status.list"},{title:"Добавить",url:"extension.shop.order.status.create"}]},{title:"Товары",url:"extension.shop.product.list",items:[{title:"Список",url:"extension.shop.product.list"},{title:"Добавить",url:"extension.shop.product.create"}]}]}};angular.adminModule("shop",["ui.router","bincms.rest","bincms.admin.shop.templates"],config).constant("shopDaysWeek",[{value:"Пн"},{value:"Вт"},{value:"Ср"},{value:"Чт"},{value:"Пт"},{value:"Сб"},{value:"Вс"}]).config(["$stateProvider",function(e){e.state("extension.shop",{url:"/shop"}).state("extension.shop.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/list.html",controller:"ShopListExtensionController"}}}).state("extension.shop.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/create.html",controller:"ShopCreateExtensionController",resolve:{warehouses:["$warehouseService",function(e){return e.query().$promise}]}}}}).state("extension.shop.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/update.html",controller:"ShopUpdateExtensionController",resolve:{shop:["$shopService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}],warehouses:["$warehouseService",function(e){return e.query().$promise}]}}}}).state("extension.shop.category",{url:"/category"}).state("extension.shop.category.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/category/list.html",controller:"CategoryListExtensionController"}}}).state("extension.shop.category.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/category/create.html",controller:"CategoryCreateExtensionController"}}}).state("extension.shop.category.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/category/update.html",controller:"CategoryUpdateExtensionController",resolve:{category:["$categoryService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}}).state("extension.shop.delivery",{url:"/delivery"}).state("extension.shop.delivery.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/delivery/list.html",controller:"DeliveryListExtensionController"}}}).state("extension.shop.delivery.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/delivery/create.html",controller:"DeliveryCreateExtensionController"}}}).state("extension.shop.delivery.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/delivery/update.html",controller:"DeliveryUpdateExtensionController",resolve:{delivery:["$deliveryService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}}).state("extension.shop.manufacturer",{url:"/manufacturer"}).state("extension.shop.manufacturer.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/manufacturer/list.html",controller:"ManufacturerListExtensionController"}}}).state("extension.shop.manufacturer.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/manufacturer/create.html",controller:"ManufacturerCreateExtensionController"}}}).state("extension.shop.manufacturer.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/manufacturer/update.html",controller:"ManufacturerUpdateExtensionController",resolve:{manufacturer:["$manufacturerService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}}).state("extension.shop.order",{url:"/order"}).state("extension.shop.order.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/order/list.html",controller:"OrderListExtensionController"}}}).state("extension.shop.order.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/order/create.html",controller:"OrderCreateExtensionController"}}}).state("extension.shop.order.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/order/update.html",controller:"OrderUpdateExtensionController",resolve:{manufacturer:["$orderService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}}).state("extension.shop.order.status",{url:"/status"}).state("extension.shop.order.status.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/order/status/list.html",controller:"OrderStatusListExtensionController"}}}).state("extension.shop.order.status.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/order/status/create.html",controller:"OrderStatusCreateExtensionController"}}}).state("extension.shop.order.status.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/order/status/update.html",controller:"OrderStatusUpdateExtensionController",resolve:{orderStatus:["$orderStatusService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}}).state("extension.shop.product",{url:"/product"}).state("extension.shop.product.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/shop/product/list.html",controller:"ProductListExtensionController",resolve:{categoryId:["$location",function(e){return e.search().categoryId||null}]}}}}).state("extension.shop.product.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/shop/product/create.html",controller:"ProductCreateExtensionController"}}}).state("extension.shop.product.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/shop/product/update.html",controller:"ProductUpdateExtensionController",resolve:{product:["$productService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}})}]);var ShopMainExtensionController=BaseController.extend({init:function(e,t){this.urlService=t,this._super(e)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.instance="ShopMainExtensionController",this.$scope.$content=this.urlService.view("@Shop::main")},destroy:function(){}});ShopMainExtensionController.$inject=["$scope","$urlService"],angular.module("bincms.admin.shop").controller("ShopMainExtensionController",ShopMainExtensionController);var GoogleService=Class.extend({init:function(e){this.httpService=e},searchAddress:function(e){if(""==e)return[];var t={address:e,sensor:!1};return this.httpService.get("http://maps.googleapis.com/maps/api/geocode/json",{params:t}).then(function(e){return e.data.results})},extractAddress:function(e){var t=[];t.location=e.geometry.location;for(var o=0;o<e.address_components.length;o++){var s=e.address_components[o];if(s.types.length>=1){var i=s.types[0];t[i]={name:{"long":s.long_name,"short":s.short_name}}}}return t}}),GoogleServiceProvider=Class.extend({$get:["$http",function(e){return new GoogleService(e)}]});angular.module("bincms.admin.shop").provider("$googleService",GoogleServiceProvider);var CategoryCreateExtensionController=BaseController.extend({init:function(e,t){this.categoryService=t,this._super(e)},getDefaultCategoryModel:function(){return{title:"",parent:null}},getDefaultSelected:function(){return{category:null}},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.category&&angular.isDefined(this.$scope.selected.category)&&(t.parent=this.$scope.selected.category.id),this.categoryService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getParents:function(e){return""==e?[]:this.categoryService.query({text:e,text_comparison:"endswith",direct:!1}).$promise},resetForm:function(){this.$scope.categoryModel=this.getDefaultCategoryModel(),this.$scope.selected=this.getDefaultSelected()},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.getParents=this.getParents.bind(this),this.$scope.categoryModel=this.getDefaultCategoryModel(),this.$scope.selected=this.getDefaultSelected()},destroy:function(){}});CategoryCreateExtensionController.$inject=["$scope","$categoryService"],angular.module("bincms.admin.shop").controller("CategoryCreateExtensionController",CategoryCreateExtensionController);var CategoryListExtensionController=BaseController.extend({init:function(e,t,o){this.categoryService=t,this.locationService=o,this.searchData=this.locationService.search(),this._super(e)},onLoadChildClick:function(e){this.loadChild(e)},loadChild:function(e){if(!1!==e)var t=this.categoryService.getChildren({id:e},function(){t.length>0&&(this.$scope.categories=t,this.$scope.breadcrumb=t[0].paths,this.locationService.search("parentId",e))}.bind(this));else var t=this.categoryService.query(function(){this.$scope.categories=t,this.locationService.search("parentId",null),this.$scope.breadcrumb=[]}.bind(this))},onLoadRootChildClick:function(){this.loadChild(!1)},onCategoryRemoveClick:function(e){this.categoryService.delete({id:e.id},this.onCategoryRemoveSuccessCallback.bind(this,e))},onCategoryRemoveSuccessCallback:function(e,t){if(t.success){var o=this.$scope.categories.indexOf(e);-1!==o&&this.$scope.categories.splice(o,1)}},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.breadcrumb=[],this.$scope.onLoadChildClick=this.onLoadChildClick.bind(this),this.$scope.onLoadRootChildClick=this.onLoadRootChildClick.bind(this),this.$scope.onCategoryRemoveClick=this.onCategoryRemoveClick.bind(this);var e=this.searchData.parentId||!1;this.loadChild(e)},destroy:function(){}});CategoryListExtensionController.$inject=["$scope","$categoryService","$location"],angular.module("bincms.admin.shop").controller("CategoryListExtensionController",CategoryListExtensionController);var CategoryUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.categoryService=t,this.category=o,this._super(e)},getDefaultCategoryModel:function(){return{title:"",parent:null}},getDefaultSelected:function(){return{category:null}},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.category&&angular.isDefined(this.$scope.selected.category)&&(t.parent=this.$scope.selected.category.id),this.categoryService.update({id:this.category.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getParents:function(e){return this.categoryService.query({text:e}).$promise},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.instance="CategoryUpdateExtensionController",this.$scope.onSave=this.onSave.bind(this),this.$scope.getParents=this.getParents.bind(this),this.$scope.selected=this.getDefaultSelected(),this.$scope.categoryModel=this.category,this.$scope.selected.category=this.category.parent},destroy:function(){}});CategoryUpdateExtensionController.$inject=["$scope","$categoryService","category"],angular.module("bincms.admin.shop").controller("CategoryUpdateExtensionController",CategoryUpdateExtensionController);var DeliveryCreateExtensionController=BaseController.extend({init:function(e,t){this.deliveryService=t,this._super(e)},getDefaultDeliveryModel:function(){return{title:"",description:"",price:0,enabled:!0}},onSave:function(e,t){e.validate()&&this.deliveryService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},resetForm:function(){this.$scope.deliveryModel=this.getDefaultDeliveryModel()},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.deliveryModel=this.getDefaultDeliveryModel()},destroy:function(){}});DeliveryCreateExtensionController.$inject=["$scope","$deliveryService"],angular.module("bincms.admin.shop").controller("DeliveryCreateExtensionController",DeliveryCreateExtensionController);var DeliveryListExtensionController=BaseController.extend({init:function(e,t,o){this.deliveryService=t,this.locationService=o,this.searchData=this.locationService.search(),this._super(e)},onSelectPage:function(e){this.loadPage(e)},onDeliveryRemoveSuccessCallback:function(e){var t=this.$scope.deliveries.indexOf(e);-1!==t&&this.$scope.deliveries.splice(t,1)},loadPage:function(e){var t=this.deliveryService.get({per_page:10,page:e},function(){this.$scope.deliveries=t.items,this.$scope.pagination=t.pagination,this.locationService.search("page",e)}.bind(this))},onDeliveryRemoveClick:function(e){this.deliveryService.delete({id:e.id},this.onDeliveryRemoveSuccessCallback.bind(this,e))},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSelectPage=this.onSelectPage.bind(this),this.$scope.onDeliveryRemoveClick=this.onDeliveryRemoveClick.bind(this);var e=this.searchData.page||null;this.loadPage(e)},destroy:function(){}});DeliveryListExtensionController.$inject=["$scope","$deliveryService","$location"],angular.module("bincms.admin.shop").controller("DeliveryListExtensionController",DeliveryListExtensionController);var DeliveryUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.deliveryService=t,this.delivery=o,this._super(e)},getDefaultDeliveryModel:function(){return{title:"",description:"",price:0,enabled:!0}},onSave:function(e,t){e.validate()&&this.deliveryService.update({id:this.delivery.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.instance="DeliveryUpdateExtensionController",this.$scope.onSave=this.onSave.bind(this),this.$scope.deliveryModel=this.delivery},destroy:function(){}});DeliveryUpdateExtensionController.$inject=["$scope","$deliveryService","delivery"],angular.module("bincms.admin.shop").controller("DeliveryUpdateExtensionController",DeliveryUpdateExtensionController);var ManufacturerCreateExtensionController=BaseController.extend({init:function(e,t){this.manufacturerService=t,this._super(e)},getDefaultManufacturerModel:function(){return{title:"",url:""}},onSave:function(e,t){e.validate()&&this.manufacturerService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},resetForm:function(){this.$scope.manufacturerModel=this.getDefaultManufacturerModel()},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.manufacturerModel=this.getDefaultManufacturerModel()},destroy:function(){}});ManufacturerCreateExtensionController.$inject=["$scope","$manufacturerService"],angular.module("bincms.admin.shop").controller("ManufacturerCreateExtensionController",ManufacturerCreateExtensionController);var ManufacturerListExtensionController=BaseController.extend({init:function(e,t,o){this.manufacturerService=t,this.locationService=o,this.searchData=this.locationService.search(),this._super(e)},onSelectPage:function(e){this.loadPage(e)},onLoadPageClick:function(e){this.loadPage(e)},onManufacturerRemoveSuccessCallback:function(e){var t=this.$scope.manufactures.indexOf(e);-1!==t&&this.$scope.manufactures.splice(t,1)},loadPage:function(e){this.$scope.currentPage=e;var t=this.manufacturerService.get({page:e,per_page:15},function(){this.$scope.manufactures=t.items,this.$scope.pagination=t.pagination,this.locationService.search("page",e)}.bind(this))},onManufacturerRemoveClick:function(e){this.manufacturerService.delete({id:e.id},this.onManufacturerRemoveSuccessCallback.bind(this,e))},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onLoadPageClick=this.onLoadPageClick.bind(this),this.$scope.onManufacturerRemoveClick=this.onManufacturerRemoveClick.bind(this),this.$scope.onSelectPage=this.onSelectPage.bind(this);var e=this.searchData.page||null;this.loadPage(e)},destroy:function(){}});ManufacturerListExtensionController.$inject=["$scope","$manufacturerService","$location"],angular.module("bincms.admin.shop").controller("ManufacturerListExtensionController",ManufacturerListExtensionController);var ManufacturerUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.manufacturerService=t,this.manufacturer=o,this._super(e)},getDefaultManufacturerModel:function(){return{title:"",parent:null}},onSave:function(e,t){e.validate()&&this.manufacturerService.update({id:this.manufacturer.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.manufacturerModel=this.manufacturer},destroy:function(){}});ManufacturerUpdateExtensionController.$inject=["$scope","$manufacturerService","$manufacturer"],angular.module("bincms.admin.shop").controller("ManufacturerUpdateExtensionController",ManufacturerUpdateExtensionController);var OrderListExtensionController=BaseController.extend({init:function(e,t,o){this.orderService=t,this.locationService=o,this.searchData=this.locationService.search(),this._super(e)},onSelectPage:function(e){this.loadPage(e)},onOrderRemoveSuccessCallback:function(e,t){if(t.success){var o=this.$scope.orders.indexOf(e);-1!==o&&this.$scope.orders.splice(o,1)}},loadPage:function(e){var t=this.orderService.get({page:e},function(){this.$scope.orders=t.items,this.$scope.pagination=t.pagination,this.locationService.search("page",e)}.bind(this))},onOrderRemoveClick:function(e){this.orderService.delete({id:e.id},this.onOrderRemoveSuccessCallback.bind(this,e))},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.orders=[],this.$scope.onSelectPage=this.onSelectPage.bind(this),this.$scope.onOrderRemoveClick=this.onOrderRemoveClick.bind(this);var e=this.searchData.page||null;this.loadPage(e)},destroy:function(){}});OrderListExtensionController.$inject=["$scope","$orderService","$location"],angular.module("bincms.admin.shop").controller("OrderListExtensionController",OrderListExtensionController);var OrderStatusCreateExtensionController=BaseController.extend({init:function(e,t){this.orderStatusService=t,this._super(e)},getDefaultOrderStatusModel:function(){return{title:""}},onSave:function(e,t){e.validate()&&this.orderStatusService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},resetForm:function(){this.$scope.orderStatusModel=this.getDefaultOrderStatusModel()},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.orderStatusModel=this.getDefaultOrderStatusModel()},destroy:function(){}});OrderStatusCreateExtensionController.$inject=["$scope","$orderStatusService"],angular.module("bincms.admin.shop").controller("OrderStatusCreateExtensionController",OrderStatusCreateExtensionController);var OrderStatusListExtensionController=BaseController.extend({init:function(e,t,o){this.orderStatusService=t,this.locationService=o,this.searchData=this.locationService.search(),this._super(e)},onLoadPageClick:function(e){this.loadPage(e)},onOrderStatusRemoveSuccessCallback:function(e){var t=this.$scope.statuses.indexOf(e);-1!==t&&this.$scope.statuses.splice(t,1)},onSelectPage:function(e){this.loadPage(e)},loadPage:function(e){this.$scope.currentPage=e;var t=this.orderStatusService.get({page:e,per_page:15},function(){this.$scope.statuses=t.items,this.$scope.pagination=t.pagination,this.locationService.search("page",e)}.bind(this))},onOrderStatusRemoveClick:function(e){this.orderStatusService.delete({id:e.id},this.onOrderStatusRemoveSuccessCallback.bind(this,e))},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.statuses=[],this.$scope.onLoadPageClick=this.onLoadPageClick.bind(this),this.$scope.onOrderStatusRemoveClick=this.onOrderStatusRemoveClick.bind(this),this.$scope.onSelectPage=this.onSelectPage.bind(this);var e=this.searchData.page||null;this.loadPage(e)},destroy:function(){}});OrderStatusListExtensionController.$inject=["$scope","$orderStatusService","$location"],angular.module("bincms.admin.shop").controller("OrderStatusListExtensionController",OrderStatusListExtensionController);var OrderStatusUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.orderStatusService=t,this.orderStatus=o,this._super(e)},getDefaultOrderStatusModel:function(){return{title:""}},onSave:function(e,t){e.validate()&&this.orderStatusService.update({id:this.orderStatus.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},resetForm:function(){this.$scope.orderStatusModel=this.getDefaultOrderStatusModel()},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.instance="OrderStatusUpdateExtensionController",this.$scope.onSave=this.onSave.bind(this),this.$scope.orderStatusModel=this.orderStatus},destroy:function(){}});OrderStatusUpdateExtensionController.$inject=["$scope","$orderStatusService","orderStatus"],angular.module("bincms.admin.shop").controller("OrderStatusUpdateExtensionController",OrderStatusUpdateExtensionController);var OrderUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.orderService=t,this.order=o,this._super(e)},onSave:function(e,t){e.validate()&&this.orderService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.order=this.order},destroy:function(){}});OrderUpdateExtensionController.$inject=["$scope","$orderService","order"],angular.module("bincms.admin.shop").controller("OrderUpdateExtensionController",OrderUpdateExtensionController);var ProductCreateExtensionController=BaseController.extend({init:function(e,t,o){this.productService=t,this.categoryService=o,this._super(e)},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.category&&angular.isDefined(this.$scope.selected.category)&&(t.categoryId=this.$scope.selected.category.id),this.productService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getDefaultProductModel:function(){return{sku:"",title:"",categoryId:"",availability:0,isLeader:!1,isNew:!1,price:{retail:0}}},getDefaultSelected:function(){return{category:null}},resetForm:function(){this.$scope.productModel=this.getDefaultProductModel(),this.$scope.selected=this.getDefaultSelected()},getCategories:function(e){return""!=e?this.categoryService.query({text:e,text_comparison:"endswith"}).$promise:[]},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.getCategories=this.getCategories.bind(this),this.resetForm()},destroy:function(){}});ProductCreateExtensionController.$inject=["$scope","$productService","$categoryService"],angular.module("bincms.admin.shop").controller("ProductCreateExtensionController",ProductCreateExtensionController);var ProductListExtensionController=BaseController.extend({init:function(e,t,o,s,i){this.productService=t,this.timeoutService=o,this.locationService=s,this.searchData=this.locationService.search(),this.categoryId=i,this.filterPromise=null,this._super(e)},onLoadPageClick:function(e){this.loadPage(e)},onProductRemoveSuccessCallback:function(e){var t=this.$scope.products.indexOf(e);-1!==t&&this.$scope.products.splice(t,1)},onSelectPage:function(e){this.loadPage(e)},loadPage:function(e,t){t=angular.extend({},t,{page:e,per_page:15}),null!==this.categoryId&&(t.categoryId=this.categoryId);var o=this.productService.get(t,function(){this.$scope.products=o.items,this.$scope.pagination=o.pagination,this.locationService.search("page",e)}.bind(this))},onProductRemoveClick:function(e){this.productService.delete({id:e.id},this.onProductRemoveSuccessCallback.bind(this,e))},onFilterQueryKeyUp:function(e){null!=this.filterPromise&&this.timeoutService.cancel(this.filterPromise),this.filterPromise=this.timeoutService(function(){var t=angular.element(e.target).val();if(""!=t)switch(this.$scope.filter.selected){case"by_sku":return this.loadPage(1,{sku:t}),void 0}this.loadPage(1)}.bind(this),500)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onLoadPageClick=this.onLoadPageClick.bind(this),this.$scope.onProductRemoveClick=this.onProductRemoveClick.bind(this),this.$scope.onSelectPage=this.onSelectPage.bind(this),this.$scope.onFilterQueryKeyUp=this.onFilterQueryKeyUp.bind(this),this.$scope.filter={selected:null},this.$scope.filters=[{label:"артикулу",value:"by_sku"}];var e=this.searchData.page||null;this.loadPage(e)},destroy:function(){}});ProductListExtensionController.$inject=["$scope","$productService","$timeout","$location","categoryId"],angular.module("bincms.admin.shop").controller("ProductListExtensionController",ProductListExtensionController);var ProductUpdateExtensionController=BaseController.extend({init:function(e,t,o){this.productService=t,this.product=o,this._super(e)},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.category&&angular.isDefined(this.$scope.selected.category)&&(t.categoryId=this.$scope.selected.category.id),this.productService.update({id:this.product.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getCategories:function(e){return""!=e?this.categoryService.query({text:e,text_comparison:"endswith"}).$promise:[]},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.getCategories=this.getCategories.bind(this),this.$scope.productModel=this.product,this.$scope.selected={category:this.product.category}},destroy:function(){}});ProductUpdateExtensionController.$inject=["$scope","$productService","product"],angular.module("bincms.admin.shop").controller("ProductUpdateExtensionController",ProductUpdateExtensionController);var ShopCreateExtensionController=BaseController.extend({init:function(e,t,o,s,i){this.shopService=t,this.googleService=o,this.warehouses=s,this.shopDaysWeek=i,this._super(e)},getDefaultShopModel:function(){return{title:"",country:"",shedule:{values:[]},city:"",street:"",house:"",lat:"",lng:"",warehouses:[]}},onSave:function(e,t){e.validate()&&this.shopService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},searchAddress:function(e){return this.googleService.searchAddress(e)},onSelectedGoogleAddress:function(e,t){var t=this.googleService.extractAddress(t);this.$scope.shopModel.country=t.country.name.long,this.$scope.shopModel.city=t.locality.name.short,this.$scope.shopModel.street=t.route?t.route.name.short:"",this.$scope.shopModel.house=t.street_number?t.street_number.name.short:"",t.location&&(this.$scope.shopModel.lat=t.location.lat,this.$scope.shopModel.lng=t.location.lng)},onAddSheduleClick:function(){this.$scope.shopModel.shedule.values.push({})},onRemoveSheduleClick:function(e){this.$scope.shopModel.shedule.values.splice(e,1)},addWarehouse:function(e){-1===angular.findItemWithArray(this.$scope.shopModel.warehouses,"id",e.id)&&this.$scope.shopModel.warehouses.push(e),this.$scope.selected.warehouse=null},removeWarehouse:function(e){angular.removeItemWithArray(this.$scope.shopModel.warehouses,"id",e.id)},resetForm:function(){this.$scope.shopModel=this.getDefaultShopModel()},defineListeners:function(){this._super(),this.$scope.$on("$typeahead.select.googleAddress",this.onSelectedGoogleAddress.bind(this))},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.searchAddress=this.searchAddress.bind(this),this.$scope.onAddSheduleClick=this.onAddSheduleClick.bind(this),this.$scope.onRemoveSheduleClick=this.onRemoveSheduleClick.bind(this),this.$scope.addWarehouse=this.addWarehouse.bind(this),this.$scope.removeWarehouse=this.removeWarehouse.bind(this),this.$scope.warehouses=this.warehouses,this.$scope.selected={warehouse:null},this.$scope.shopModel=this.getDefaultShopModel(),this.$scope.daysWeek=this.shopDaysWeek},destroy:function(){}});ShopCreateExtensionController.$inject=["$scope","$shopService","$googleService","warehouses","shopDaysWeek"],angular.module("bincms.admin.shop").controller("ShopCreateExtensionController",ShopCreateExtensionController);var ShopListExtensionController=BaseController.extend({init:function(e,t,o){this.shopService=t,this.locationService=o,this.dataSearch=this.locationService.search(),this._super(e)},onSelectPage:function(e){this.loadPage(e)},removeSuccessCallback:function(e){var t=this.$scope.shops.indexOf(e);-1!==t&&this.$scope.shops.splice(t,1)},loadPage:function(e){var t=this.shopService.get({page:e,per_page:15},function(){this.$scope.shops=t.items,this.$scope.pagination=t.pagination,this.locationService.search("page",e)}.bind(this))},onRemoveClick:function(e){this.shopService.delete({id:e.id},this.removeSuccessCallback.bind(this,e))},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onRemoveClick=this.onRemoveClick.bind(this),this.$scope.onSelectPage=this.onSelectPage.bind(this);var e=this.dataSearch.page||1;this.loadPage(e)},destroy:function(){}});ShopListExtensionController.$inject=["$scope","$shopService","$location"],angular.module("bincms.admin.shop").controller("ShopListExtensionController",ShopListExtensionController);var ShopUpdateExtensionController=BaseController.extend({init:function(e,t,o,s,i,r){this.googleService=o,this.shopService=t,this.shop=i,this.shopDaysWeek=r,this.warehouses=s,this._super(e)},getDefaultShopModel:function(){return{title:""}},onSave:function(e,t){e.validate()&&this.shopService.update({id:this.shop.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},searchAddress:function(e){return this.googleService.searchAddress(e)},onSelectedGoogleAddress:function(e,t){var t=this.googleService.extractAddress(t);this.$scope.shopModel.country=t.country.name.long,this.$scope.shopModel.city=t.locality.name.short,this.$scope.shopModel.street=t.route?t.route.name.short:"",this.$scope.shopModel.house=t.street_number?t.street_number.name.short:"",t.location&&(this.$scope.shopModel.lat=t.location.lat,this.$scope.shopModel.lng=t.location.lng)
},onAddSheduleClick:function(){null==this.$scope.shopModel.shedule&&(this.$scope.shopModel.shedule={values:[]}),this.$scope.shopModel.shedule.values.push({})},onRemoveSheduleClick:function(e){this.$scope.shopModel.shedule.values.splice(e,1)},addWarehouse:function(e){-1===angular.findItemWithArray(this.$scope.shopModel.warehouses,"id",e.id)&&this.$scope.shopModel.warehouses.push(e),this.$scope.selected.warehouse=null},removeWarehouse:function(e){angular.removeItemWithArray(this.$scope.shopModel.warehouses,"id",e.id)},defineListeners:function(){this._super(),this.$scope.$on("$typeahead.select.googleAddress",this.onSelectedGoogleAddress.bind(this))},defineScope:function(){this._super(),this.$scope.instance="ShopUpdateExtensionController",this.$scope.onSave=this.onSave.bind(this),this.$scope.searchAddress=this.searchAddress.bind(this),this.$scope.onAddSheduleClick=this.onAddSheduleClick.bind(this),this.$scope.onRemoveSheduleClick=this.onRemoveSheduleClick.bind(this),this.$scope.addWarehouse=this.addWarehouse.bind(this),this.$scope.removeWarehouse=this.removeWarehouse.bind(this),this.$scope.warehouses=this.warehouses,this.$scope.daysWeek=this.shopDaysWeek,this.$scope.selected={warehouse:null},this.$scope.shopModel=this.shop},destroy:function(){}});ShopUpdateExtensionController.$inject=["$scope","$shopService","$googleService","warehouses","shop","shopDaysWeek"],angular.module("bincms.admin.shop").controller("ShopUpdateExtensionController",ShopUpdateExtensionController);